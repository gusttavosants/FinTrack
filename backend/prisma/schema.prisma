// prisma/schema.prisma
datasource db {
  provider = "sqlite"
  
}

generator client {
  provider = "prisma-client-js"
}

// O que você deve escrever abaixo:
model User {
  id                     String    @id @default(uuid())
  name                   String
  email                  String    @unique
  password_hash          String
  cpf                    String?   @unique
  phone                  String?
  avatar                 String?
  reset_password_token   String?
  reset_password_expires DateTime?
  created_at             DateTime  @default(now())
  
  accounts               Account[]
  bankConnections        BankConnection[]
  
  @@map("users")
}

model Account {
  id              String        @id @default(uuid())
  user_id         String
  account_number  String        @unique
  balance         Decimal       @default(0)
  account_type    String        @default("checking") // "checking" ou "savings"
  currency        String        @default("BRL")
  created_at      DateTime      @default(now())
  updated_at      DateTime      @updatedAt
  
  user            User          @relation(fields: [user_id], references: [id], onDelete: Cascade)
  transactions    Transaction[]
  credit_cards    CreditCard[]
  
  @@map("accounts")
}

model Transaction {
  id              String    @id @default(uuid())
  account_id      String
  type            String    // "income" (entrada) ou "expense" (saída)
  category        String    // "salary", "food", "transport", "entertainment", etc
  amount          Decimal
  description     String
  recipient       String?   // Nome de quem enviou/recebeu
  date            DateTime  @default(now())
  created_at      DateTime  @default(now())
  
  account         Account   @relation(fields: [account_id], references: [id], onDelete: Cascade)
  
  @@map("transactions")
}

model CreditCard {
  id                  String              @id @default(uuid())
  account_id          String
  card_number_last4   String              // Últimos 4 dígitos
  card_brand          String              // "visa", "mastercard", "elo"
  card_holder_name    String
  credit_limit        Decimal
  available_limit     Decimal
  current_invoice     Decimal             @default(0)
  due_date            Int                 // Dia do vencimento (1-31)
  is_active           Boolean             @default(true)
  created_at          DateTime            @default(now())
  
  account             Account             @relation(fields: [account_id], references: [id], onDelete: Cascade)
  card_transactions   CardTransaction[]
  
  @@map("credit_cards")
}

model CardTransaction {
  id              String      @id @default(uuid())
  card_id         String
  category        String      // "food", "shopping", "fuel", etc
  amount          Decimal
  description     String
  merchant        String      // Nome da loja/estabelecimento
  date            DateTime    @default(now())
  installments    Int         @default(1) // Número de parcelas
  created_at      DateTime    @default(now())
  
  card            CreditCard  @relation(fields: [card_id], references: [id], onDelete: Cascade)
  
  @@map("card_transactions")
}

model BankConnection {
  id              String    @id @default(uuid())
  user_id         String
  provider        String    // "pluggy", "brapi", "openbanking"
  item_id         String    // ID da conexão na API externa
  access_token    String?   // Token de acesso
  status          String    // "connected", "error", "updating"
  last_sync       DateTime?
  created_at      DateTime  @default(now())
  
  user            User      @relation(fields: [user_id], references: [id])
  
  @@map("bank_connections")
}

model SyncLog {
  id              String    @id @default(uuid())
  connection_id   String
  status          String    // "success", "error"
  message         String?
  synced_at       DateTime  @default(now())
  
  @@map("sync_logs")
}